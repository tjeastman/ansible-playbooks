---
- name: update APT cache
  apt: update_cache=yes
- name: install Apache web server
  apt: name=apache2 update_cache=no state=latest
- name: install Ganglia packages
  apt: name={{ item }} update_cache=no state=latest
  with_items:
    - rrdtool
    - gmetad
    - ganglia-webfrontend
- name: configure Ganglia server
  template: src=gmetad.conf dest=/etc/ganglia/
- name: restart Ganglia server
  service: name=gmetad state=restarted
- name: install Ganglia web frontend site file
  copy: src=apache2-ganglia.conf dest=/etc/apache2/sites-available
- name: enable Ganglia web frontend site
  command: a2ensite apache2-ganglia creates=/etc/apache2/sites-enabled/apache2-ganglia.conf
- name: restart Apache web server
  service: name=apache2 state=restarted
